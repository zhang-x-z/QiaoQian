(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-283f13d7"],{b0a3:function(t,i,e){},df14:function(t,i,e){"use strict";e.r(i);var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"mark-proc"},[e("el-header",[e("nav-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("i",{staticClass:"el-icon-close",on:{click:t.back}})]},proxy:!0},{key:"center",fn:function(){return[e("span",[t._v("涂鸦笔")])]},proxy:!0},{key:"right",fn:function(){return[e("i",{staticClass:"el-icon-check",on:{click:t.finish}})]},proxy:!0}])})],1),e("el-main",[e("div",{ref:"imgContainer",staticClass:"img-container"},[e("canvas",{ref:"canvas",attrs:{width:t.width,height:t.height},on:{touchstart:t.handleDrawBegin,touchmove:t.handleDrawMove}})])]),e("div",{staticClass:"range-container"},[e("div",{staticClass:"range-bar"},[e("mt-range",{attrs:{min:1,max:10,step:1},on:{change:t.handleChange},model:{value:t.rangeValue,callback:function(i){t.rangeValue=i},expression:"rangeValue"}},[e("div",{staticClass:"range-bar",attrs:{slot:"start"},slot:"start"},[t._v("1")]),e("div",{staticClass:"range-bar",attrs:{slot:"end"},slot:"end"},[t._v("10")])])],1),e("div",{staticClass:"range-value"},[e("span",[t._v("画笔大小："+t._s(t.rangeValue))])])]),e("el-footer",{staticClass:"tabs"},[e("div",{staticClass:"button-group"},[e("el-button",{attrs:{plain:"",icon:"el-icon-back"},on:{click:t.handleCancel}}),e("el-button",{attrs:{plain:"",icon:"el-icon-right"},on:{click:t.handleRedo}}),e("el-button",{attrs:{plain:"",icon:"el-icon-refresh-right"},on:{click:t.handleClear}})],1),e("el-color-picker",{attrs:{predefine:t.predefineColors},model:{value:t.penColor,callback:function(i){t.penColor=i},expression:"penColor"}})],1)],1)},a=[],h=(e("b680"),e("3835")),n=e("6259"),r=(e("025e"),{name:"MarkProc",components:{NavBar:n["a"]},data:function(){return{savedImg:"",userImg:"",width:"",height:"",canvas:null,context:null,imgWidth:0,imgHeight:0,imgX:0,imgY:0,rangeValue:2,penColor:"red",predefineColors:["#FF0000","#000000","#008000","#FFFF00","#0000FF","#A020F0","#808080","#A52A2A","#D2B48C","#00FFFF"],lastImgArr:[],redoImgArr:[],imgObj:{},dx:0,dy:0,mx:0,my:0,timestamp:0,maxV:10,minV:.1,lastLineWidth:-1,maxLineWidth:3,minLineWidth:.1}},methods:{init:function(){var t=this;this.rangeValue=2,this.userImg=this.$store.state.editedImg,this.width=this.$refs.imgContainer.offsetWidth,this.height=this.$refs.imgContainer.offsetHeight,this.canvas=this.$refs.canvas,this.context=this.canvas.getContext("2d"),this.context.clearRect(0,0,this.width,this.height),this.imgObj=new Image,this.imgObj.crossOrigin="anonymous",this.imgObj.src=this.userImg,this.imgObj.onload=function(){var i=t.resize(t.imgObj.width,t.imgObj.height),e=Object(h["a"])(i,4);t.imgWidth=e[0],t.imgHeight=e[1],t.imgX=e[2],t.imgY=e[3],t.context.drawImage(t.imgObj,t.imgX,t.imgY,t.imgWidth,t.imgHeight)},this.lastImgArr=[],this.redoImgArr=[]},resize:function(t,i){var e,s,a,h;return t<=this.width&&i<=this.height?(e=t,s=i,a=(this.width-e)/2,h=(this.height-s)/2):t/i>=this.width/this.height?(e=this.width,s=this.width*(i/t),a=0,h=(this.height-s)/2):(s=this.height,e=this.height*(t/i),a=(this.width-e)/2,h=0),[e,s,a,h]},back:function(){this.$router.back()},finish:function(){var t=this.context.getImageData(this.imgX,this.imgY,this.imgWidth,this.imgHeight),i=document.createElement("canvas");i.width=this.imgWidth,i.height=this.imgHeight;var e=i.getContext("2d");e.putImageData(t,0,0,0,0,this.imgWidth,this.imgHeight),this.savedImg=i.toDataURL(),this.$store.commit("saveImg",this.savedImg),this.$router.back()},handleDrawBegin:function(t){this.lastImgArr.push(this.context.getImageData(0,0,this.width,this.height));var i=t.targetTouches[0];this.dx=i.pageX.toFixed(0)-this.canvas.offsetLeft,this.dy=i.pageY.toFixed(0)-this.canvas.offsetTop,this.timestamp=(new Date).getTime()},handleDrawMove:function(t){var i=t.targetTouches[0];this.mx=i.pageX.toFixed(0)-this.canvas.offsetLeft,this.my=i.pageY.toFixed(0)-this.canvas.offsetTop;var e=(new Date).getTime(),s=this.calcDistance(),a=e-this.timestamp;this.lastLineWidth=this.calcLineWidth(s,a),this.drawLine(),this.dx=this.mx,this.dy=this.my},handleCancel:function(){if(this.lastImgArr.length){var t=this.context.getImageData(0,0,this.width,this.height);this.context.putImageData(this.lastImgArr.pop(),0,0),this.redoImgArr.push(t)}},handleRedo:function(){if(this.redoImgArr.length){var t=this.context.getImageData(0,0,this.width,this.height);this.context.putImageData(this.redoImgArr.pop(),0,0),this.lastImgArr.push(t)}},handleClear:function(){if(this.lastImgArr.length){var t=this.lastImgArr.shift();this.context.putImageData(t,0,0),this.lastImgArr=[],this.redoImgArr=[]}},handleChange:function(){this.lastLineWidth=this.rangeValue},calcLineWidth:function(t,i){var e,s=t/i;return e=s<=this.minV?this.maxLineWidth:s>=this.maxV?this.minLineWidth:this.maxLineWidth-(s-this.minV)/(this.maxV-this.minV)*(this.maxLineWidth-this.minLineWidth),-1==this.lastLineWidth?e*this.rangeValue:e*this.rangeValue*2/3+1*this.lastLineWidth/3},calcDistance:function(){return Math.sqrt(Math.pow(this.mx-this.dx,2)+Math.pow(this.my-this.dy,2))},drawLine:function(){this.context.beginPath(),this.context.lineTo(this.dx,this.dy),this.context.lineTo(this.mx,this.my),this.context.lineWidth=this.lastLineWidth,this.context.lineCap="round",this.context.lineJoin="round",this.context.strokeStyle=this.penColor,this.context.stroke()}},activated:function(){this.init()}}),o=r,c=(e("e2aa"),e("2877")),g=Object(c["a"])(o,s,a,!1,null,"70051a18",null);i["default"]=g.exports},e2aa:function(t,i,e){"use strict";var s=e("b0a3"),a=e.n(s);a.a}}]);
//# sourceMappingURL=chunk-283f13d7.e5301326.js.map