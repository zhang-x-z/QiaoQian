{"version":3,"sources":["webpack:///./src/views/Mobile/SpliceView.vue?9ef4","webpack:///src/views/Mobile/SpliceView.vue","webpack:///./src/views/Mobile/SpliceView.vue?465e","webpack:///./src/views/Mobile/SpliceView.vue","webpack:///./src/views/Mobile/SpliceView.vue?a910"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","scopedSlots","_u","key","fn","on","back","proxy","_v","finish","directives","name","rawName","value","expression","attrs","staticStyle","res_url","_e","ref","_l","item","i","handleLoad","handleError","handleChange","handleExceed","slot","splice","staticRenderFns","a","scrollX","scrollY","data","imgs","fullScreenLoading","hasRes","computed","imgs_num","length","components","NavBar","mounted","setTimeout","activated","bs","methods","$router","element","href","setAttribute","time","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","click","$message","error","reader","readAsDataURL","file","raw","onload","url","method","JSON","stringify","img_num","editedImg","error_code","component"],"mappings":"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","file":"js/chunk-f7a0fa98.591e0c3e.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"spliceview-wapper\"},[_c('div',{staticClass:\"navbar-wapper\"},[_c('nav-bar',{scopedSlots:_vm._u([{key:\"left\",fn:function(){return [_c('i',{staticClass:\"el-icon-back\",on:{\"click\":_vm.back}})]},proxy:true},{key:\"center\",fn:function(){return [_c('span',[_vm._v(\"全景拼接\")])]},proxy:true},{key:\"right\",fn:function(){return [_c('i',{staticClass:\"el-icon-check\",on:{\"click\":_vm.finish}})]},proxy:true}])})],1),_c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.fullScreenLoading),expression:\"fullScreenLoading\"}],attrs:{\"element-loading-text\":\"处理中...\",\"element-loading-background\":\"rgba(0, 0, 0, 0.6)\"}},[_c('div',{staticClass:\"result-wapper\"},[(_vm.hasRes)?_c('el-image',{staticStyle:{\"width\":\"96vw\",\"height\":\"60vh\"},attrs:{\"fit\":\"scale-down\",\"src\":_vm.res_url}}):_vm._e()],1)]),_c('div',{ref:\"scroll\",staticClass:\"scroll-wapper\"},[_c('div',{staticClass:\"scroll-content\"},_vm._l((_vm.imgs),function(item,i){return _c('el-image',{key:i,staticStyle:{\"height\":\"15vh\",\"width\":\"15vh\",\"margin-left\":\"2vw\",\"margin-right\":\"2vw\",\"margin-top\":\"2vh\"},attrs:{\"fit\":\"cover\",\"src\":item},on:{\"load\":_vm.handleLoad,\"error\":_vm.handleError}})}),1)]),_c('div',{staticClass:\"buttons-wapper\"},[_c('el-upload',{staticClass:\"upload\",attrs:{\"action\":\"#\",\"limit\":10,\"on-change\":_vm.handleChange,\"on-exceed\":_vm.handleExceed,\"auto-upload\":false,\"show-file-list\":false}},[_c('el-button',{staticStyle:{\"height\":\"7vh\",\"width\":\"48vw\",\"font-size\":\"20px\"},attrs:{\"slot\":\"trigger\",\"plain\":\"\"},slot:\"trigger\"},[_vm._v(\"上传图片\")])],1),_c('el-button',{staticStyle:{\"height\":\"7vh\",\"width\":\"48vw\",\"font-size\":\"20px\"},attrs:{\"plain\":\"\"},on:{\"click\":_vm.splice}},[_vm._v(\"开始转换\")])],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"spliceview-wapper\">\r\n    <div class=\"navbar-wapper\">\r\n      <nav-bar>\r\n        <template v-slot:left>\r\n          <i class=\"el-icon-back\" @click=\"back\"></i>\r\n        </template>\r\n        <template v-slot:center>\r\n          <span>全景拼接</span>\r\n        </template>\r\n        <template v-slot:right>\r\n          <i class=\"el-icon-check\" @click=\"finish\"></i>\r\n        </template>\r\n      </nav-bar>\r\n    </div>\r\n    <div v-loading=\"fullScreenLoading\" element-loading-text=\"处理中...\" element-loading-background=\"rgba(0, 0, 0, 0.6)\">\r\n      <div class=\"result-wapper\">\r\n        <el-image v-if=\"hasRes\" style=\"width:96vw;height:60vh;\" fit=\"scale-down\" :src=\"res_url\"></el-image>\r\n      </div>\r\n    </div>\r\n    <div class=\"scroll-wapper\" ref=\"scroll\">\r\n      <div class=\"scroll-content\">\r\n        <el-image\r\n          @load=\"handleLoad\"\r\n          @error=\"handleError\"\r\n          v-for=\"(item, i) in imgs\"\r\n          :key=\"i\"\r\n          fit=\"cover\"\r\n          style=\"height:15vh;width:15vh;margin-left:2vw;margin-right:2vw;margin-top:2vh;\"\r\n          :src=\"item\"\r\n        ></el-image>\r\n      </div>\r\n    </div>\r\n    <div class=\"buttons-wapper\">\r\n      <el-upload\r\n        action=\"#\"\r\n        :limit=\"10\"\r\n        :on-change=\"handleChange\"\r\n        :on-exceed=\"handleExceed\"\r\n        :auto-upload=\"false\"\r\n        :show-file-list=\"false\"\r\n        class=\"upload\"\r\n      >\r\n        <el-button plain slot=\"trigger\" style=\"height:7vh;width:48vw;font-size:20px\">上传图片</el-button>\r\n      </el-upload>\r\n      <el-button plain style=\"height:7vh;width:48vw;font-size:20px\" @click=\"splice\">开始转换</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport NavBar from '@/components/common/Mobile/NavBar'\r\nimport BScroll from 'better-scroll'\r\nimport axios from 'axios'\r\nimport { baseurl } from '@/utils.js'\r\n//TODO: need to change\r\naxios.defaults.baseURL = baseurl()\r\nconst option = {\r\n  scrollX: true,\r\n  scrollY: false\r\n}\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      imgs: [],\r\n      fullScreenLoading: false,\r\n      hasRes: false,\r\n      res_url: ''\r\n    }\r\n  },\r\n  computed: {\r\n    imgs_num () {\r\n      return this.imgs.length\r\n    }\r\n  },\r\n  components: {\r\n    NavBar\r\n  },\r\n  mounted () {\r\n    setTimeout(() => {\r\n      this.bs = new BScroll(this.$refs.scroll, option)\r\n    }, 20)\r\n  },\r\n  activated () {\r\n    this.imgs.splice(0, this.imgs.length)\r\n    if (this.bs) {\r\n      setTimeout(() => {\r\n        this.bs.refresh()\r\n      }, 20)\r\n    }\r\n  },\r\n  methods: {\r\n    back () {\r\n      this.$router.back()\r\n    },\r\n    finish () {\r\n      if (this.hasRes) {\r\n        let time = new Date()\r\n        const element = document.createElement('a')\r\n        element.href = this.res_url\r\n        element.setAttribute('download', '处理结果-' + time.getFullYear() + '-' + (time.getMonth() + 1) + '-' + time.getDate() + '-' + time.getHours() + time.getMinutes() + time.getSeconds())\r\n        element.click()\r\n        // console.log('保存图片')\r\n      } else {\r\n        this.$message.error('您还没有进行处理哦')\r\n      }\r\n    },\r\n    handleExceed () {\r\n      this.$message.error('最多选择十个文件哦')\r\n    },\r\n    handleLoad () {\r\n      setTimeout(() => {\r\n        this.bs.refresh()\r\n      }, 20)\r\n    },\r\n    handleError () {\r\n      this.$message.error('上传失败!')\r\n      setTimeout(() => {\r\n        this.bs.refresh()\r\n      }, 20)\r\n    },\r\n    handleChange (file, fileList) {\r\n      let reader = new FileReader()\r\n      reader.readAsDataURL(file.raw)\r\n      reader.onload = (event) => {\r\n        let imgUrl = event.target.result\r\n        this.imgs.push(imgUrl)\r\n      }\r\n    },\r\n    splice () {\r\n      if (this.imgs_num >= 2) {\r\n        this.fullScreenLoading = true\r\n        axios({\r\n          url: 'imgProc/stitch/',\r\n          method: 'post',\r\n          data: JSON.stringify({\r\n            img_num: this.imgs_num,\r\n            editedImg: this.imgs\r\n          })\r\n        }).then(res => {\r\n          let error_code = res.data.error_code\r\n          if (error_code === 1008) {\r\n            this.$message.error('处理失败，请稍后再试')\r\n          } else if (error_code === 0) {\r\n            this.res_url = res.data.img_proc_result\r\n            this.hasRes = true\r\n            this.imgs.splice(0, this.imgs.length)\r\n            setTimeout(() => {\r\n              this.bs.refresh()\r\n            }, 20)\r\n            this.$message.success('处理成功!')\r\n          }\r\n          this.fullScreenLoading = false\r\n        }).catch(err => {\r\n          this.$message.error('出错了，请检查您的网络连接')\r\n          this.fullScreenLoading = false\r\n        })\r\n      } else {\r\n        this.$message.error('请至少选择两张图片!')\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.spliceview-wapper {\r\n  background-color: #eeeeee;\r\n  position: relative;\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n\r\n.navbar-wapper {\r\n  background-color: rgba(250, 251, 252, 224);\r\n  position: sticky;\r\n  position: -webkit-sticky;\r\n  top: 0;\r\n  z-index: 100;\r\n  font-size: 22px;\r\n}\r\n\r\n.result-wapper {\r\n  height: 60vh;\r\n  margin-top: 3vh;\r\n  margin-bottom: 4vh;\r\n  margin-left: 2vw;\r\n  margin-right: 2vw;\r\n}\r\n\r\n.scroll-wapper {\r\n  background-color: rgba(250, 251, 252, 224);\r\n  height: 18vh;\r\n  width: 100vw;\r\n  margin-top: 1vh;\r\n  margin-bottom: 1vh;\r\n  white-space: nowrap;\r\n  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.scroll-content {\r\n  line-height: 18vh;\r\n  height: 18vh;\r\n  display: inline-block;\r\n}\r\n\r\n.buttons-wapper {\r\n  display: flex;\r\n  justify-content: space-around;\r\n}\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SpliceView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SpliceView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SpliceView.vue?vue&type=template&id=28257228&scoped=true&\"\nimport script from \"./SpliceView.vue?vue&type=script&lang=js&\"\nexport * from \"./SpliceView.vue?vue&type=script&lang=js&\"\nimport style0 from \"./SpliceView.vue?vue&type=style&index=0&id=28257228&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"28257228\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SpliceView.vue?vue&type=style&index=0&id=28257228&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SpliceView.vue?vue&type=style&index=0&id=28257228&scoped=true&lang=css&\""],"sourceRoot":""}