(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e8b35722"],{"0cf1":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{attrs:{"body-style":{padding:"0px"},shadow:"always"}},[t._t("image"),a("div",{staticStyle:{padding:"14px"}},[t._t("title"),a("div",{staticClass:"bottom clearfix"},[t._t("describe"),t._t("button")],2)],2)],2)},o=[],s={},i=s,n=(a("9b82"),a("2877")),l=Object(n["a"])(i,r,o,!1,null,"41d46507",null);e["a"]=l.exports},"4de4":function(t,e,a){"use strict";var r=a("23e7"),o=a("b727").filter,s=a("1dde"),i=a("ae40"),n=s("filter"),l=i("filter");r({target:"Array",proto:!0,forced:!n||!l},{filter:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},"501c":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"album-wapper"},[a("div",{staticClass:"navbar-wapper"},[a("nav-bar",[a("div",{attrs:{slot:"left"},on:{click:function(e){return t.Back()}},slot:"left"},[a("i",{staticClass:"el-icon-caret-left"})]),a("div",{attrs:{slot:"center"},slot:"center"},[t._v("我的相册")]),a("div",{attrs:{slot:"right"},slot:"right"},[a("i",{staticClass:"el-icon-circle-plus",on:{click:function(e){return t.showAddAlbum()}}})])])],1),a("el-dialog",{attrs:{title:"添加相册",visible:t.dialogFormVisible,width:"70%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"nameForm",attrs:{model:t.formData,rules:t.rules}},[a("el-form-item",{attrs:{label:"相册名称","label-width":"80px",prop:"albumName"}},[a("el-input",{attrs:{maxlength:"30",autocomplete:"off"},model:{value:t.formData.albumName,callback:function(e){t.$set(t.formData,"albumName",e)},expression:"formData.albumName"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{plain:""},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(e){return t.addAlbum()}}},[t._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"相册信息",visible:t.albumDialogVisible,width:"70%"},on:{"update:visible":function(e){t.albumDialogVisible=e}}},[a("el-form",{ref:"albumForm",attrs:{model:t.albumForm,rules:t.albumRules}},[a("el-form-item",{attrs:{label:"相册名称","label-width":"80px",prop:"name"}},[a("el-input",{attrs:{maxlength:"30",autocomplete:"off"},model:{value:t.albumForm.name,callback:function(e){t.$set(t.albumForm,"name",e)},expression:"albumForm.name"}})],1)],1),a("p",{staticStyle:{"margin-bottom":"10px"}},[t._v("照片数量："+t._s(t.albumForm.size))]),a("p",[t._v("创建时间："+t._s(t.albumForm.date))]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-popconfirm",{attrs:{slot:"button",confirmButtonText:"确认",cancelButtonText:"手抖了",icon:"el-icon-warning",iconColor:"red",title:"确定删除该相册吗？"},on:{onConfirm:function(e){return t.deleteAlbum()}},slot:"button"},[a("el-button",{staticStyle:{"margin-right":"3vh"},attrs:{slot:"reference",plain:"",type:"danger"},slot:"reference"},[t._v("删 除")])],1),a("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(e){return t.changeName()}}},[t._v("确 定")])],1)],1),a("div",{staticClass:"album-content"},[a("div",{ref:"scroll",staticClass:"scroll-wapper"},[a("div",{staticClass:"scroll-content"},t._l(t.albumInfo,(function(e){return a("album-card",{key:e.id,staticStyle:{"margin-bottom":"16px"}},[a("el-image",{staticClass:"image",attrs:{slot:"image",fit:"cover",src:e.url},on:{load:t.onLoadSuccess,error:t.onLoadError,click:function(a){return t.toAlbumMore(e)}},slot:"image"}),a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),a("span",{staticClass:"date",attrs:{slot:"describe"},slot:"describe"},[t._v(t._s(e.date+"创建"))]),a("i",{staticClass:"el-icon-more more-btn",attrs:{slot:"button"},on:{click:function(a){return t.showAlbumDialog(e)}},slot:"button"})],1)})),1)])])],1)},o=[],s=(a("4de4"),a("a434"),a("b0c0"),a("6259")),i=a("0cf1"),n=a("1fba"),l=a("bc3a"),u=a.n(l),m=a("025e");u.a.defaults.baseURL=Object(m["a"])();var c={click:!0,scrollbar:{fade:!0,interactive:!0}},b={name:"user-album",data:function(){var t=this;return{albumInfo:[],dialogFormVisible:!1,albumDialogVisible:!1,formData:{albumName:""},albumForm:{id:"",name:"",size:"",date:""},albumRules:{name:[{required:!0,trigger:"blur",validator:function(e,a,r){if(a){var o=t.albumForm.id,s=t.albumInfo.filter((function(t){return t.name===a&&t.id!==o})).length;0!==s?r(new Error("您已经有该名称的相册啦")):r()}else r(new Error("相册名不能为空！"))}}]},rules:{albumName:[{required:!0,trggier:"blur",validator:function(e,a,r){a?0!==t.albumInfo.filter((function(t){return t.name===a})).length?r(new Error("您已经有该名称的相册啦")):r():r(new Error("相册名不能为空！"))}}]}}},watch:{albumInfo:function(){var t=this;setTimeout((function(){t.bs.refresh()}),20)}},activated:function(){var t=this;this.bs&&setTimeout((function(){t.bs.refresh()}),20)},mounted:function(){var t=this;this.$store.state.isLogin?(u.a.get("user/getAllAlbumsInfo/",{params:{user_id:this.$store.state.user.userID},timeout:5e3}).then((function(t){return t.data})).then((function(e){var a=e.error_code;0===a?t.albumInfo=e.AlbumsInfo:1006===a&&t.$message.error("数据获取失败，请稍后再试")})).catch((function(e){console.log(e),t.$message.error("数据获取失败，请检查您的网络连接")})),setTimeout((function(){t.bs=new n["a"](t.$refs.scroll,c)}),20)):this.$router.push("/")},components:{NavBar:s["a"],AlbumCard:i["a"]},computed:{},methods:{showAddAlbum:function(){this.formData.albumName="",this.dialogFormVisible=!0},onLoadSuccess:function(t){var e=this;setTimeout((function(){e.bs.refresh()}),20)},onLoadError:function(t){var e=this;setTimeout((function(){e.bs.refresh()}),20)},addAlbum:function(){var t=this;this.$refs.nameForm.validate((function(e){if(e){var a=new FormData;a.append("album_name",t.formData.albumName),a.append("user_id",t.$store.state.user.userID),u.a.post("user/add-album/",a,{timeout:2e3}).then((function(e){var a=e.data.error_code;if(0===a){var r=e.data.album_info;t.bs.scrollTo(0,0,100),t.albumInfo.unshift(r),t.$message.success("添加成功!"),t.dialogFormVisible=!1}else 1006===a&&t.$message.error("添加失败，请您稍后再试~")})).catch((function(e){console.log(e),t.$message.error("添加失败，请您检查您的网络连接")}))}else t.$message.error("您输入的信息有误!")}))},Back:function(){this.$router.back(-1)},toAlbumMore:function(t){this.$store.commit("changeCurrentAlbum",t),this.$router.push("/album-page")},changeName:function(){var t=this;this.$refs.albumForm.validate((function(e){if(e){if(t.albumForm.name===t.selectedAlbum.name)return void(t.dialogFormVisible=!1);var a=new FormData;a.append("user_id",t.$store.state.user.userID),a.append("album_id",t.albumForm.id),a.append("album_name",t.selectedAlbum.name),a.append("album_new_name",t.albumForm.name),u.a.post("user/change-album-name/",a,{timeout:2e3}).then((function(t){return t.data})).then((function(e){var a=e.error_code;0===a?(t.selectedAlbum.name=t.albumForm.name,t.albumDialogVisible=!1,t.$message.success("修改成功!")):1006===a&&t.$message.error("修改失败，请您稍后再试")})).catch((function(e){console.log(e),t.$message.error("修改失败，请检查您的网络连接")}))}else t.$message.error("您输入的信息有误!")}))},showAlbumDialog:function(t){this.albumForm.name=t.name,this.albumForm.id=t.id,this.albumForm.size=t.size,this.albumForm.date=t.date,this.selectedAlbum=t,this.albumDialogVisible=!0},deleteAlbum:function(){for(var t=this,e=0,a=0;a<this.albumInfo.length;a++)if(this.selectedAlbum.id===this.albumInfo[a].id){e=a;break}var r=new FormData;r.append("user_id",this.$store.state.user.userID),r.append("album_name",this.selectedAlbum.name),u.a.post("user/delete-album/",r,{timeout:2e3}).then((function(a){var r=a.data.error_code;0===r?(t.$message.success("删除成功!"),t.albumInfo.splice(e,1),t.albumDialogVisible=!1):1006===r&&t.$message.error("删除失败，请稍后再试")})).catch((function(e){console.log(e),t.$message.error("删除失败，请检查您的网络连接")}))}}},f=b,d=(a("cd6e"),a("2877")),h=Object(d["a"])(f,r,o,!1,null,"5c897a56",null);e["default"]=h.exports},"9b82":function(t,e,a){"use strict";var r=a("a7ef"),o=a.n(r);o.a},a7ef:function(t,e,a){},b0c0:function(t,e,a){var r=a("83ab"),o=a("9bf2").f,s=Function.prototype,i=s.toString,n=/^\s*function ([^ (]*)/,l="name";r&&!(l in s)&&o(s,l,{configurable:!0,get:function(){try{return i.call(this).match(n)[1]}catch(t){return""}}})},cd6e:function(t,e,a){"use strict";var r=a("e23a"),o=a.n(r);o.a},e23a:function(t,e,a){}}]);
//# sourceMappingURL=chunk-e8b35722.a25f769b.js.map