(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c819baba"],{"40d8":function(t,i,a){"use strict";var e=a("713d"),s=a.n(e);s.a},"713d":function(t,i,a){},8999:function(t,i,a){"use strict";a.r(i);var e=function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"mosaic-proc"},[a("el-header",[a("nav-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[a("i",{staticClass:"el-icon-close",on:{click:t.back}})]},proxy:!0},{key:"center",fn:function(){return[a("span",[t._v("马赛克")])]},proxy:!0},{key:"right",fn:function(){return[a("i",{staticClass:"el-icon-check",on:{click:t.finish}})]},proxy:!0}])})],1),a("el-main",[a("div",{ref:"imgContainer",staticClass:"img-container"},[a("canvas",{ref:"canvas",attrs:{width:t.width,height:t.height},on:{touchstart:t.handleDrawBegin,touchmove:t.handleDrawMove}})])]),a("div",{staticClass:"range-container"},[a("div",{staticClass:"range-bar"},[a("mt-range",{attrs:{min:1,max:10,step:1},model:{value:t.rangeValue,callback:function(i){t.rangeValue=i},expression:"rangeValue"}},[a("div",{staticClass:"range-bar",attrs:{slot:"start"},slot:"start"},[t._v("1")]),a("div",{staticClass:"range-bar",attrs:{slot:"end"},slot:"end"},[t._v("10")])])],1),a("div",{staticClass:"range-value"},[a("span",[t._v("画笔大小："+t._s(t.rangeValue))])])]),a("el-footer",{staticClass:"tabs"},[a("div",{staticClass:"button-group"},[a("el-button",{attrs:{plain:"",icon:"el-icon-back"},on:{click:t.handleCancel}}),a("el-button",{attrs:{plain:"",icon:"el-icon-right"},on:{click:t.handleRedo}}),a("el-button",{attrs:{plain:"",icon:"el-icon-refresh-right"},on:{click:t.handleClear}})],1)])],1)},s=[],h=(a("b680"),a("3835")),n=a("6259"),r=(a("025e"),{name:"MosaicProc",components:{NavBar:n["a"]},data:function(){return{savedImg:"",userImg:"",width:0,height:0,canvas:null,context:null,imgWidth:0,imgHeight:0,imgX:0,imgY:0,rangeValue:3,mosaicNum:12,lastImgArr:[],redoImgArr:[],imgObj:{},dx:0,dy:0}},methods:{init:function(){var t=this;this.rangeValue=3,this.userImg=this.$store.state.editedImg,this.width=this.$refs.imgContainer.offsetWidth,this.height=this.$refs.imgContainer.offsetHeight,this.canvas=this.$refs.canvas,this.context=this.canvas.getContext("2d"),this.context.clearRect(0,0,this.width,this.height),this.imgObj=new Image,this.imgObj.crossOrigin="anonymous",this.imgObj.src=this.userImg,this.imgObj.onload=function(){var i=t.resize(t.imgObj.width,t.imgObj.height),a=Object(h["a"])(i,4);t.imgWidth=a[0],t.imgHeight=a[1],t.imgX=a[2],t.imgY=a[3],t.context.drawImage(t.imgObj,t.imgX,t.imgY,t.imgWidth,t.imgHeight)},this.lastImgArr=[],this.redoImgArr=[]},resize:function(t,i){var a,e,s,h;return t<=this.width&&i<=this.height?(a=t,e=i,s=(this.width-a)/2,h=(this.height-e)/2):t/i>=this.width/this.height?(a=this.width,e=this.width*(i/t),s=0,h=(this.height-e)/2):(e=this.height,a=this.height*(t/i),s=(this.width-a)/2,h=0),[a,e,s,h]},back:function(){this.$router.back()},finish:function(){var t=this.context.getImageData(this.imgX,this.imgY,this.imgWidth,this.imgHeight),i=document.createElement("canvas");i.width=this.imgWidth,i.height=this.imgHeight;var a=i.getContext("2d");a.putImageData(t,0,0,0,0,this.imgWidth,this.imgHeight),this.savedImg=i.toDataURL(),this.$store.commit("saveImg",this.savedImg),this.$router.back()},handleDrawBegin:function(t){this.lastImgArr.push(this.context.getImageData(0,0,this.width,this.height));var i=t.targetTouches[0],a=i.pageX.toFixed(0)-this.canvas.offsetLeft,e=i.pageY.toFixed(0)-this.canvas.offsetTop;this.dx=a,this.dy=e,this.drawLine(a,e)},handleDrawMove:function(t){var i=t.targetTouches[0],a=i.pageX.toFixed(0)-this.canvas.offsetLeft,e=i.pageY.toFixed(0)-this.canvas.offsetTop;Math.pow(this.dx-a,2)+Math.pow(this.dy-e,2)>=Math.pow(this.rangeValue*this.mosaicNum,2)/3&&(this.drawLine(a,e),this.dx=a,this.dy=e)},handleCancel:function(){if(this.lastImgArr.length){var t=this.context.getImageData(0,0,this.width,this.height);this.context.putImageData(this.lastImgArr.pop(),0,0),this.redoImgArr.push(t)}},handleRedo:function(){if(this.redoImgArr.length){var t=this.context.getImageData(0,0,this.width,this.height);this.context.putImageData(this.redoImgArr.pop(),0,0),this.lastImgArr.push(t)}},handleClear:function(){if(this.lastImgArr.length){var t=this.lastImgArr.shift();this.context.putImageData(t,0,0),this.lastImgArr=[],this.redoImgArr=[]}},drawLine:function(t,i){for(var a=this.context.getImageData(0,0,this.width,this.height),e=a.data,s=this.context.getImageData(0,0,this.width,this.height),h=s.data,n=this.rangeValue,r=this.mosaicNum,o=t-n*r;o<t+n*r;o=o+2*n+1){for(var g=i-n*r;g<i+n*r;g=g+2*n+1)if(Math.pow(o-t,2)+Math.pow(g-i,2)<=Math.pow(n*r/2,2)&&!(o==t-n*r&&g==i-n*r||o==t-n*r&&g==i-n*r+2*n+1||o==t-n*r&&g==i-n*r+4*n+2||o==t-n*r&&g==i-n*r+12*n+6||o==t-n*r&&g==i-n*r+14*n+7||o==t-n*r&&g==i-n*r+16*n+8||o==t-n*r+16*n+8&&g==i-n*r||o==t-n*r+16*n+8&&g==i-n*r+2*n+1||o==t-n*r+16*n+8&&g==i-n*r+4*n+2||o==t-n*r+16*n+8&&g==i-n*r+12*n+6||o==t-n*r+16*n+8&&g==i-n*r+14*n+7||o==t-n*r+16*n+8&&g==i-n*r+16*n+8||o==t-n*r+2*n+1&&g==i-n*r||o==t-n*r+4*n+2&&g==i-n*r||o==t-n*r+12*n+6&&g==i-n*r||o==t-n*r+14*n+7&&g==i-n*r||o==t-n*r+2*n+1&&g==i-n*r+16*n+8||o==t-n*r+4*n+2&&g==i-n*r+16*n+8||o==t-n*r+12*n+6&&g==i-n*r+16*n+8||o==t-n*r+14*n+7&&g==i-n*r+16*n+8)){for(var c=0,d=0,l=0,m=-n;m<=n;m++)for(var u=-n;u<=n;u++){var f=o+m,v=g+u,p=v*this.width+f;c+=e[4*p+0],d+=e[4*p+1],l+=e[4*p+2]}for(var w=(2*n+1)*(2*n+1),I=c/w,b=d/w,x=l/w,C=-n;C<=n;C++)for(var k=-n;k<=n;k++){var D=o+C,A=g+k,y=A*this.width+D;h[4*y+0]=I,h[4*y+1]=b,h[4*y+2]=x}}this.context.putImageData(s,0,0,0,0,this.width,this.height)}}},activated:function(){this.init()}}),o=r,g=(a("40d8"),a("2877")),c=Object(g["a"])(o,e,s,!1,null,"238bfebc",null);i["default"]=c.exports}}]);
//# sourceMappingURL=chunk-c819baba.3618aec7.js.map